<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="fragments/common::header('Product Details')"></th:block>
<body>
	<div class="container-fluid">
		<!-- Navigation Bar -->
		<div class="row">
			<div class="col">
				<div th:replace="fragments/common::navbar">Navigation bar goes here</div>
			</div>
		</div>
		
		<div class="row">
			<div class="col">
				<div class="container mt-3 shadow p-3 mb-5 bg-white rounded">
					<!-- New Product  Form -->
					<h2>NEW PRODUCT</h2>
                    <div class="row">
                        <div class="col-lg-12">
                            <th:block th:if="${message != null}">
                                <div class="alert alert-success alert-dismissible" role="alert">
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        X
                                    </button>
                                    <strong th:text="${message}"></strong>
                                </div>
                            </th:block>
                        </div>
                    </div>
					<form th:action="@{/products}" th:object="${product}" method="post" enctype="multipart/form-data">
						<input type="hidden" th:field="*{id}" />
						
						<div class="row">
							<div class="col-sm">
                                <div class="form-group">
                                  <label for="sku">SKU:</label> 
                                  <span class="validationError text-danger" th:if="${#fields.hasErrors('sku')}" th:errors="*{sku}"></span>
                                  <span class="validationError text-danger" th:if="${duplicateSku}">must be unique</span>
                                  <input class="form-control" type="text" th:field="*{sku}" />
                                </div>
                            </div>
                            
                            <div class="col-sm">
								<div class="form-group">
                                    <!-- <datalist id="categories">
                                        <option th:each="c : ${categories}" th:value="${c.id}" th:text="${c.name}"></option>
                                    </datalist>
									<input type="text" class="form-control" th:field="*{category}" list="categories"/> -->
									<label for="categoryId">Category:</label> 
                                    <span class="validationError text-danger" th:if="${categoryNotSet}">must have a selected value</span>
                                    <select name="categoryId" id="categoryId" class="form-control">
                                        <option value="0">- Select Category -</option>
                                        <option th:each="c : ${categories}" 
                                            th:value="${c.id}" 
                                            th:text="${c.name}"
                                            th:selected="${c.id == product.categoryId}"></option>
                                    </select>
                                    <a th:href="@{/categories/new}" class="btn btn-dark mt-2">Add New Category</a> 
                                    <input type="hidden" name="category" id="category" />
								</div>
							</div>
						</div>	
						
						<div class="row">
                            <div class="col-sm">
                                <!-- Name -->
                                <div class="form-group">
                                    <label for="name">Name:</label> 
                                    <span class="validationError text-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></span>
                                    <input class="form-control" type="text" th:field="*{name}" />
                                </div>
                            </div>
                            
                            <div class="col-sm">
                                <!-- Brand -->
                                <div class="form-group">
                                    <label for="brand">Brand:</label> 
                                    <span class="validationError text-danger" th:if="${#fields.hasErrors('brand')}" th:errors="*{brand}"></span>
                                    <input class="form-control" type="text" th:field="*{brand}" />
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
							<div class="col-sm">
								<div class="form-group">
									<label for="description">Description:</label> 
									<textarea class="form-control" th:field="*{description}" rows="4"></textarea>
								</div>
							</div>
                        </div>
            
                        <div class="row">
                            <div class="col-sm">
                            <div class="form-group">
                              <label for="photoFiles">Photos:</label> 
                              <input type="file" name="photoFiles" class="form-control fileinput" accept="image/*" multiple="multiple"
                                  />
                            </div>
                          </div>
                        </div>
						
						<div class="clearfix">
					    	<button type="submit" class="btn btn-dark float-right ml-1">Save</button>
					    	<a th:href="@{/products}" class="btn btn-dark float-right">Cancel</a>
					    </div>
					</form>
					
				</div>
			</div>
		</div>
		
		<!-- Footer -->
		<th:block th:replace="fragments/common::footer"></th:block>
	</div>
    
    <th:block th:replace="fragments/common::javascript"></th:block>
    <!-- piexif.min.js is needed for auto orienting image files OR when restoring exif data in resized images and when you wish to resize images before upload. This must be loaded before fileinput.min.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.1.3/js/plugins/piexif.min.js" type="text/javascript"></script>
    <!-- sortable.min.js is only needed if you wish to sort / rearrange files in initial preview. This must be loaded before fileinput.min.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.1.3/js/plugins/sortable.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.1.3/js/fileinput.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.1.3/themes/fas/theme.js"></script>
    
    <script type="text/javascript" th:inline="javascript">
        $(() => {
            $('.fileinput').fileinput({
                theme: 'fas',
                showCaption: false,
                showRemove: false,
                showUpload: false,
                showBrowse: false,
                browseOnZoneClick: true,
                initialPreviewAsData: true,
                initialPreviewShowDelete: false,
                maxFileSize: 1024 * 10,
                allowedFileTypes: ['image'],
                allowedFileExtensions: ['jpg','jpeg','png','gif','bmp'],
                initialPreview: /*[[${product.photos}]]*/[],
                sanitizeZoomCache: function(content) {
                    var $container = $(document.createElement('div')).append(content);
                    $container.find('input,select,.file-thumbnail-footer').remove();
                    $container.find('.kv-zoom-cache').hide();
                    return $container.html();
                },
            });
            
            $('#categoryId').on('change', (e) => {
                console.log(e.target,$('#categoryId option:selected').text());
                $('#category').val($('#categoryId option:selected').text());
            });
        })
    </script>
</body>
</html>